# ğŸ”„ ì‹¤ì‹œê°„ íˆ´ í˜¸ì¶œ í‘œì‹œ ê¸°ëŠ¥

## ê°œìš”

Text2SQL Agentì— **ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°** ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì–´, ì‚¬ìš©ìê°€ ì§ˆì˜ë¥¼ ë³´ë‚´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ UIì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ğŸ¯ **ë¶„ì„ ê³„íš ìˆ˜ë¦½**
- ğŸ”§ **ë„êµ¬ í˜¸ì¶œ ìƒíƒœ** (KOSIS API, DataFrame ì¿¼ë¦¬ ë“±)
- ğŸ“Š **ë°ì´í„° ì²˜ë¦¬ ê³¼ì •**
- ğŸ“ˆ **ìµœì¢… ê²°ê³¼ ìƒì„±**

## ì£¼ìš” íŠ¹ì§•

### 1. ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© í‘œì‹œ
```
ğŸš€ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...
ğŸ“‹ ê³„íš ìˆ˜ë¦½ ì™„ë£Œ: 3ê°œ ë‹¨ê³„
ğŸ”§ ë„êµ¬ í˜¸ì¶œ: fetch_kosis_data (ğŸ”„ ì‹¤í–‰ ì¤‘...)
âœ… ë„êµ¬ ì‹¤í–‰ ì™„ë£Œ: fetch_kosis_data
ğŸ“Š ë°ì´í„° ì¿¼ë¦¬ ì‹¤í–‰ ì¤‘...
ğŸ“ˆ ìµœì¢… ê²°ê³¼ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...
```

### 2. íˆ´ ì‹¤í–‰ ìƒíƒœ ì‹œê°í™”
- ğŸ”„ **ì‹¤í–‰ ì¤‘**: ë…¸ë€ìƒ‰ ì ë©¸ í‘œì‹œ
- âœ… **ì™„ë£Œ**: ì´ˆë¡ìƒ‰ ì™„ë£Œ í‘œì‹œ  
- âŒ **ì˜¤ë¥˜**: ë¹¨ê°„ìƒ‰ ì˜¤ë¥˜ í‘œì‹œ

### 3. ìƒì„¸í•œ ë©”íƒ€ë°ì´í„°
- ì‹¤í–‰ ì‹œê°„
- íˆ´ íŒŒë¼ë¯¸í„°
- ë°ì´í„°í”„ë ˆì„ í¬ê¸°
- ì˜¤ë¥˜ ë©”ì‹œì§€

## ì‚¬ìš© ë°©ë²•

### ë°±ì—”ë“œ API

#### ê¸°ì¡´ API (ì¼ë°˜ ì‘ë‹µ)
```http
POST /v1/chat/completions
Content-Type: application/json

{
  "model": "text2sql",
  "messages": [{"role": "user", "content": "í•œêµ­ì˜ ì¸êµ¬ í†µê³„ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"}]
}
```

#### ìƒˆë¡œìš´ ìŠ¤íŠ¸ë¦¬ë° API
```http
POST /v1/chat/stream
Content-Type: application/json

{
  "model": "text2sql", 
  "messages": [{"role": "user", "content": "í•œêµ­ì˜ ì¸êµ¬ í†µê³„ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"}]
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ì‚¬ìš©

ChatContainerì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì´ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤:

```typescript
// ì‚¬ìš©ìê°€ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ìë™ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
const handleSendMessage = async (content: string) => {
  // ìŠ¤íŠ¸ë¦¬ë° API í˜¸ì¶œ
  await sendChatMessageStream({
    message: content,
    sessionId: activeSessionId,
  }, (update) => {
    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì²˜ë¦¬
    switch (update.type) {
      case 'start': // ì‹œì‘
      case 'step': // ë‹¨ê³„ ì§„í–‰
      case 'tool_call': // íˆ´ í˜¸ì¶œ
      case 'query': // ì¿¼ë¦¬ ì‹¤í–‰
      case 'result': // ìµœì¢… ê²°ê³¼
      case 'error': // ì˜¤ë¥˜
      case 'done': // ì™„ë£Œ
    }
  });
};
```

## ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ íƒ€ì…

### 1. start
```json
{
  "type": "start",
  "message": "ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...",
  "status": "running"
}
```

### 2. step (ë‹¨ê³„ ì§„í–‰)
```json
{
  "type": "step", 
  "step": "planning",
  "message": "âœ… ê³„íš ìˆ˜ë¦½ ì™„ë£Œ: 3ê°œ ë‹¨ê³„",
  "status": "completed",
  "data": {
    "steps": ["KOSIS ë°ì´í„° ì¡°íšŒ", "ë°ì´í„° ë¶„ì„", "ê²°ê³¼ ì‹œê°í™”"]
  }
}
```

### 3. tool_call (íˆ´ í˜¸ì¶œ)
```json
{
  "type": "tool_call",
  "tool_name": "fetch_kosis_data", 
  "message": "âœ… ë„êµ¬ ì‹¤í–‰ ì™„ë£Œ: fetch_kosis_data",
  "status": "completed",
  "data": {
    "df_shape": [1000, 5],
    "df_name": "fetch_kosis_data_DT_1B040A3"
  }
}
```

### 4. query (ë°ì´í„° ì¿¼ë¦¬)
```json
{
  "type": "query",
  "message": "âœ… ì¿¼ë¦¬ ì‹¤í–‰ ì™„ë£Œ", 
  "status": "completed",
  "data": {
    "columns": ["ì§€ì—­", "ì¸êµ¬ìˆ˜", "ì—°ë„"],
    "rows": [["ì„œìš¸", 9720846, 2024]]
  }
}
```

### 5. result (ìµœì¢… ê²°ê³¼)
```json
{
  "type": "result",
  "message": "ğŸ“ˆ ë¶„ì„ ê²°ê³¼:\n\n| ì§€ì—­ | ì¸êµ¬ìˆ˜ | ì—°ë„ |\n|------|--------|------|\n| ì„œìš¸ | 9,720,846 | 2024 |",
  "status": "completed",
  "data": {
    "final_result": {...}
  }
}
```

### 6. error (ì˜¤ë¥˜)
```json
{
  "type": "error", 
  "message": "âŒ KOSIS API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
  "status": "error"
}
```

### 7. done (ì™„ë£Œ)
```json
{
  "type": "done",
  "message": "ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "status": "completed"
}
```

## í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸
```bash
cd backend
python test_streaming.py
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸
1. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰: `python integrated_api_server.py`
2. í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰: `npm run dev`
3. http://localhost:3000 ì ‘ì†
4. "í•œêµ­ì˜ ì¸êµ¬ í†µê³„ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”" ë“±ì˜ ì§ˆì˜ ì…ë ¥

## UI ê°œì„  ì‚¬í•­

### MessageBubble ì»´í¬ë„ŒíŠ¸
- ğŸ”§ **íˆ´ ì‹¤í–‰ ìƒíƒœ** ì„¹ì…˜ ì¶”ê°€
- ğŸ’« **ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘** ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
- ğŸ“Š **ì§„í–‰ ìƒí™©** ì‹œê°ì  í‘œì‹œ

### ì˜ˆì‹œ í™”ë©´
```
[ì‚¬ìš©ì] í•œêµ­ì˜ ì¸êµ¬ í†µê³„ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”

[AI ì‘ë‹µ]
ğŸš€ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...

ğŸ“‹ ê³„íš ìˆ˜ë¦½
âœ… ê³„íš ìˆ˜ë¦½ ì™„ë£Œ: 3ê°œ ë‹¨ê³„
1. KOSISì—ì„œ ì¸êµ¬ í†µê³„ ì¡°íšŒ
2. ë°ì´í„° ë¶„ì„ ë° ìš”ì•½  
3. ê²°ê³¼ ì‹œê°í™”

ğŸ”§ ë„êµ¬ ì‹¤í–‰ ìƒíƒœ:
â— fetch_kosis_data âœ… ì™„ë£Œ

ğŸ’« ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘...

ğŸ“ˆ ë¶„ì„ ê²°ê³¼:
| ì§€ì—­ | ì¸êµ¬ìˆ˜ | ì¦ê°ë¥  |
|------|--------|--------|
| ì„œìš¸ | 9,720,846 | -0.91% |
| ë¶€ì‚° | 3,349,016 | -1.64% |
```

## ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### ë°±ì—”ë“œ (FastAPI)
- **StreamingResponse** ì‚¬ìš©
- **Server-Sent Events (SSE)** í˜•ì‹
- **ë¹„ë™ê¸° ìƒì„±ì** íŒ¨í„´

### í”„ë¡ íŠ¸ì—”ë“œ (React/TypeScript)
- **Fetch API Streaming** ì‚¬ìš©
- **ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸**
- **Zustand Store** ë©”ì‹œì§€ ê´€ë¦¬

### ì£¼ì˜ì‚¬í•­
- ìŠ¤íŠ¸ë¦¬ë° ì—°ê²°ì€ 30ì´ˆ íƒ€ì„ì•„ì›ƒ
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡ ì‹œ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬
- ì˜¤ë¥˜ ë°œìƒ ì‹œ ìë™ í´ë°± ì²˜ë¦¬ 